-- CREAR FACTURAS
CREATE OR REPLACE VIEW VW_FACTURAS AS -- PARA GENERAR VISTAS NORMALES
SELECT CODIGO_FACTURA, 
    NOMBRE_PLAN, 
    TO_CHAR(FECHA_INICIO, 'DD-MM-YYYY')FECHA,
    TO_CHAR(FECHA_INICIO, 'MM-YYYY') ANIO_MES,
    MONTO, 
    DESCUENTO, 
    MONTO - DESCUENTO AS TOTAL
FROM TBL_FACTURACION_PAGOS A
INNER JOIN TBL_PLANES B
ON(A.CODIGO_PLAN = B.CODIGO_PLAN);

-- VISTA MATERIALIZADA [ES MAS EFICAZ]
CREATE MATERIALIZED VIEW MVW_FACTUAS AS
SELECT CODIGO_FACTURA, 
    NOMBRE_PLAN, 
    TO_CHAR(FECHA_INICIO, 'DD-MM-YYYY')FECHA,
    TO_CHAR(FECHA_INICIO, 'MM-YYYY') ANIO_MES,
    MONTO, 
    DESCUENTO, 
    MONTO - DESCUENTO AS TOTAL
FROM TBL_FACTURACION_PAGOS A
INNER JOIN TBL_PLANES B
ON(A.CODIGO_PLAN = B.CODIGO_PLAN);

-- ACTUALIZAR UNA VISTA MATERIALIZADA
BEGIN 
    DBMS_MVIEW.REFRESH ('MVW_FACTUAS');
END;

SELECT *
FROM TBL_PLANES;